<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Home</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="d1jZh5CKpzcf7Kh8plHnh"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="FactoryFarm.html">FactoryFarm</a></div><div class="sidebar-section-children"><a href="FactoryFarm.html">FactoryFarm</a></div><div class="sidebar-section-children"><a href="MockServer.html">MockServer</a></div><div class="sidebar-section-children"><a href="Model.html">Model</a></div><div class="sidebar-section-children"><a href="RelatedRecordsArray.html">RelatedRecordsArray</a></div><div class="sidebar-section-children"><a href="Store.html">Store</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="HwVUssk5MbL3n5oYoGdTm"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#QueryString">QueryString</a></div><div class="sidebar-section-children"><a href="global.html#addIncluded">addIncluded</a></div><div class="sidebar-section-children"><a href="global.html#addRelatedRecord">addRelatedRecord</a></div><div class="sidebar-section-children"><a href="global.html#circularFetchError">circularFetchError</a></div><div class="sidebar-section-children"><a href="global.html#circularFindError">circularFindError</a></div><div class="sidebar-section-children"><a href="global.html#coerceDataToExistingRecord">coerceDataToExistingRecord</a></div><div class="sidebar-section-children"><a href="global.html#combineRacedRequests">combineRacedRequests</a></div><div class="sidebar-section-children"><a href="global.html#defineToManyRelationships">defineToManyRelationships</a></div><div class="sidebar-section-children"><a href="global.html#defineToOneRelationships">defineToOneRelationships</a></div><div class="sidebar-section-children"><a href="global.html#definitionsByDirection">definitionsByDirection</a></div><div class="sidebar-section-children"><a href="global.html#deriveIdQueryStrings">deriveIdQueryStrings</a></div><div class="sidebar-section-children"><a href="global.html#diff">diff</a></div><div class="sidebar-section-children"><a href="global.html#disallowFetches">disallowFetches</a></div><div class="sidebar-section-children"><a href="global.html#getOneFromFactory">getOneFromFactory</a></div><div class="sidebar-section-children"><a href="global.html#makeDate">makeDate</a></div><div class="sidebar-section-children"><a href="global.html#mobxAnnotations">mobxAnnotations</a></div><div class="sidebar-section-children"><a href="global.html#mobxAnnotations">mobxAnnotations</a></div><div class="sidebar-section-children"><a href="global.html#parseErrorPointer">parseErrorPointer</a></div><div class="sidebar-section-children"><a href="global.html#parseErrors">parseErrors</a></div><div class="sidebar-section-children"><a href="global.html#removeRelatedRecord">removeRelatedRecord</a></div><div class="sidebar-section-children"><a href="global.html#requestUrl">requestUrl</a></div><div class="sidebar-section-children"><a href="global.html#serverResponse">serverResponse</a></div><div class="sidebar-section-children"><a href="global.html#setRelatedRecord">setRelatedRecord</a></div><div class="sidebar-section-children"><a href="global.html#simulatePatch">simulatePatch</a></div><div class="sidebar-section-children"><a href="global.html#simulatePost">simulatePost</a></div><div class="sidebar-section-children"><a href="global.html#singularizeType">singularizeType</a></div><div class="sidebar-section-children"><a href="global.html#stringifyIds">stringifyIds</a></div><div class="sidebar-section-children"><a href="global.html#validatePresence">validatePresence</a></div><div class="sidebar-section-children"><a href="global.html#validateProperties">validateProperties</a></div><div class="sidebar-section-children"><a href="global.html#walk">walk</a></div><div class="sidebar-section-children"><a href="global.html#wrapResponse">wrapResponse</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section class="readme"><article><p><img src="./coverage/badge-statements.svg" alt="Statements Covered!"> <img src="./coverage/badge-lines.svg" alt="Lines Covered!"> <img src="./coverage/badge-functions.svg" alt="Functions Covered!"></p><h1>mobx-async-store</h1><p>Mobx-based store for async data fetching and state management. https://iunu.github.io/mobx-async-store/</p><h2>Table of Contents</h2><ul><li><a href="#introduction">Introduction</a></li><li><a href="#development-setup">Development Setup</a></li><li><a href="#testing">Testing</a></li><li><a href="#distribution">Distribution</a></li><li><a href="#installation">Installation</a></li><li><a href="#usage">Usage</a><ul><li><a href="#create-models">Creating models by extending <code>Model</code></a></li><li><a href="#create-stores">Creating stores by extending <code>Store</code></a></li><li><a href="#initializing-stores">Initializing stores</a></li><li><a href="#getting-all-records-with-storegetall">Fetching all records with <code>Store#getAll</code>, <code>Store#fetchAll</code>, <code>Store#findAll</code></a></li><li><a href="#getting-records-by-id-with-storegetmany">Finding records by id with <code>Store#getMany</code>, <code>Store#fetchMany</code>, <code>Store#findMany</code></a></li><li><a href="#findfetch-options">Find/fetch options</a></li><li><a href="#getting-single-records-with-storegetone">Finding single records with <code>Store#getOne</code>, <code>Store#fetchOne</code>, <code>Store#findOne</code></a></li><li><a href="#clear-the-query-cache">Clear the query cache</a></li><li><a href="#adding-records-with-storeadd">Adding records with <code>Store#add</code></a></li><li><a href="#persisting-records-with-modelsave">Persisting records with <code>Model#save</code></a></li><li><a href="#handling-errors">Handling errors</a></li></ul></li></ul><h2>Introduction</h2><p><code>mobx-async-store</code> was designed to consume <a href="https://jsonapi.org">JSON::API specification</a> compliant REST APIs and provide a state management system for conveniently manipulating client-side data and keeping it in sync with the server-side.</p><p>The library uses <code>mobx</code> internally to provide reactivity and observability; i.e when you fetch data from the server or make changes to client-side records then the UI should update accordingly. This system has only be tested in combination with <code>mobx-react</code>, but should hypothetically work with libraries like <code>mobx-vue</code> or <code>mobx-angular</code>.</p><h2>Development setup</h2><p>Clone this repository and install its dependencies:</p><pre class="prettyprint source lang-bash"><code>git clone git@github.com:iunu/mobx-async-store.git
cd mobx-async-store
yarn install
</code></pre><h2>Testing</h2><p><code>yarn test</code> will run all tests.</p><h2>Distribution</h2><h3>Step 1 - Build the dist files</h3><p><code>yarn build</code> builds the library to <code>dist</code>, generating two files:</p><ul><li><code>dist/mobx-async-store.cjs.js</code> A CommonJS bundle, suitable for use in Node.js, that <code>require</code>s the external dependency. This corresponds to the <code>&quot;main&quot;</code> field in package.json</li><li><code>dist/mobx-async-store.esm.js</code> an ES module bundle, suitable for use in other people's libraries and applications, that <code>import</code>s the external dependency. This corresponds to the <code>&quot;module&quot;</code> field in package.json</li></ul><h3>Step 2 - Update the documentation</h3><p><code>yarn docs</code> updates the documentation, located in <code>docs</code>.</p><h3>Step 3 - Publish</h3><p><code>npm login</code> to authenticate yourself as someone authorized to publish this package <code>npm publish</code> (or <code>npm publish =tag=develop</code> for development releases)</p><h2>Installation</h2><pre class="prettyprint source"><code>yarn add mobx-async-store
</code></pre><h1>Usage</h1><p><code>mobx-async-store</code> uses two main classes, <code>Store</code> and <code>Model</code>. Subclasses of <code>Model</code> are used to instantiate data objects, and <code>Store</code> provides an interface to add and manipulate those objects.</p><h2>Models</h2><p>You can define models by extending them and adding your own property definitions. The static property <code>type</code> determines how the store and other objects will refer to the class (corresponds to <code>type</code> in a jsonapi document), and <code>endpoint</code> defines the path the model will use to the server. Definitions are stored in two hashes that are static properties on the model, <code>attributeDefinitions</code> and <code>relationshipDefinitions</code>. These definitions determine how data will be parsed and implemented as it is returned from the server.</p><pre class="prettyprint source lang-JavaScript"><code>import { Model } from 'mobx-async-store'

class Todo extends Model {
  static type = 'todos'
  static endpoint = 'todos'

  static attributeDefinitions = {
    title: {
      transformer: stringType,
      validator: validatesString,
      defaultValue: 'NEW TODO'
    }
  }

  static relationshipDefinitions = {
    notes: {
      direction: 'toMany',
      validator: validatesArrayPresence,
      types: ['notes', 'awesome_notes'],
      inverse: {
        name: 'todo',
        direction: 'toOne'
      }
    }
  }
}
</code></pre><h3>Attributes</h3><p>The <code>attributeDefinitions</code> hash corresponds to the <code>attributes</code> hash of a jsonapi document. It is defined by keys representing the names of the properties, and objects with definitions of those properties.</p><ul><li><code>transformer</code> - a function used to coerce the value to a given type or format</li><li><code>validator</code> - a function used to determine whether a key is allowed or not</li><li><code>defaultValue</code> - the value that is used on a new instance if none is defined</li></ul><h3>Relationships</h3><p>The <code>relationshipDefinitions</code> hash corresponds to <code>relationships</code> in a jsonapi document. It is defined by keys representing the names of the relationships, and objects with defintions of those properties.</p><ul><li><code>direction</code> - can be <code>toOne</code> or <code>toMany</code></li><li><code>validator</code> - a function used for validating a relationship</li><li><code>types</code> - an array of polymorphic model <code>types</code> that can be used for this relationship</li><li><code>inverse</code> - the other direction of a relationship. Not required, but allows models to be related both directions without explicitly defining both directions<ul><li><code>name</code> - the name the relationship uses to refer to this model. This is automatically inferred if it matches the model <code>type</code> (usually for <code>toMany</code> relationships)</li><li><code>direction</code> - the inverse direction, <code>toOne</code> or <code>toMany</code></li></ul></li></ul><h3>Model methods and properties</h3><p><a href="https://iunu.github.io/mobx-async-store/Model.html">See jsdoc documentation</a></p><h2>Store</h2><p>The store is used to collect, retrieve and refer to documents.</p><pre class="prettyprint source lang-JavaScript"><code>import AppStore from './AppStore'

const store = new AppStore({
  baseUrl: 'https//api.example.com',
  defaultFetchOptions: {
    headers: {
      'Accepts': 'application/json',
      'Content-Type': 'application/vnd.api+json',
      'X-CSRF-Token': 'EXAMPLE-CSRF-TOKEN'
    }
  },
  headersOfInterest: ['X-Iunu-Roots'],
  retryOptions: {
    attempts: 3,
    delay: 1000,
  },
  errorMessages: {
    400: 'Bad request.',
    403: 'Forbidden',
    ...
    default: 'Something went wrong.',
  }
})
</code></pre><h3>Retrieving documents</h3><p>The store uses variations of <code>get</code>, <code>find</code> and <code>fetch</code> to retrieve records from the store, with <code>All</code>, <code>Many</code>, and <code>One</code> determining how many records will be requested. An optional <code>options</code> hash provides further customization for requesting and caching.</p><ul><li><code>get</code> will only retrieve locally cached records, and will never request from the server</li><li><code>find</code> will first look for records of a given type in the store, and then will go to the server</li><li><code>fetch</code> will always request from the server</li><li><code>getAll</code>, <code>findAll</code>, and <code>fetchAll</code> retrieve all records that match the optional <code>options</code><ul><li><code>store.getAll('todos', { queryParams: { recent: true } })</code></li></ul></li><li><code>getOne</code>, <code>findOne</code>, and <code>fetchOne</code> retrieves one record. Usually used with just one id but can also use the <code>options</code> hash.<ul><li><code>store.getOne('todos', '1')</code></li></ul></li><li><code>getMany</code>, <code>findMany</code>, and <code>fetchMany</code> are like <code>One</code> but with an array of ids instead of a single id</li></ul><h4><code>queryParams</code> options</h4><p><code>mobx-async-store</code> builds queries that are <code>JSON::API</code> compliant. Requests are cached from the previous call - including any <code>queryParams</code> given.</p><pre class="prettyprint source lang-JavaScript"><code>store.findAll('todos', { queryParams: filter: { title: 'Do taxes', filter: { overdue: true } } })
// The query is: '/example_api/todos?filter[title]=Do taxes&filter[overdue]=true'
// This fetches from the server and stores the result of the query in the cache.

store.findAll('todos', { queryParams: filter: { title: 'Do taxes', filter: { overdue: true } } })
// Returns result from the cache.
</code></pre><h2>Testing</h2><p><code>FactoryFarm</code> to quickly build data models that can be used for testing. An instance of FactoryFarm has factories defined that can be used to build models at runtime.</p><p>Defining a factory You can define a factory for any model in shared-js/store. Then, objects can be built using the predefined factory, which describes attributes and relationships.</p><p>const factoryFarm = new FactoryFarm() factoryFarm.define('funZone', { type: 'zones', name: 'Fun Zone' })</p><p>const funZone = factoryFarm.build('funZone') funZone.name =&gt; 'Fun Zone'</p><p>Factories follow an inheritance tree which can be used to override some properties while keeping the other parent properties.</p><p>const factoryFarm = new FactoryFarm() factoryFarm.define('funZone', { type: 'zones', name: 'Fun Zone' }) factoryFarm.define('bigZone', { parent: 'funZone', seeding_unit_capacity: 1000 })</p><p>const funZone = factoryFarm.build('bigZone') funZone.name =&gt; 'Fun Zone' funZone.seeding_unit_capacity =&gt; 1000</p><p>FactoryFarm from utils/Testing comes pre-loaded with a number of factories. Most are singularized versions of the model name.</p><p>Factories and relationships Factories can be used to build relationships just as you would with mobx-async-store.</p><p>const factoryFarm = new FactoryFarm() const seeding_unit = factoryFarm.build('seeding_unit', { name: 'Seeding Unit 1') factoryFarm.define('bigZone', { parent: 'funZone', seeding_unit })</p><p>const funZone = factoryFarm.build('funZone') funZone.seeding_unit.name =&gt; 'Seeding Unit 1'</p><p>Dynamic factories Attributes and relationships can be defined as functions. The function will be executed at build. Passing a third parameter while building will return an array of objects.</p><p>const factoryFarm = new FactoryFarm() factoryFarm.define('dynamicZone', { parent: 'funZone', name: (index, properties) =&gt; <code>Fun Zone ${properties.id}</code>, seeding_unit: () =&gt; factoryFarm.build('seeding_unit'), })</p><p>const facility = factoryFarm.build('facility', { name: 'Jay St' })</p><p>const dynamicZones = factoryFarm.build('dynamicZone', { facility }, 2) const [zone1, zone2] = dynamicZones</p><p>zone1.name =&gt; 'Fun Zone 1' zone1.seeding_unit.name =&gt; 'Seeding Unit 1' zone1.facility.name =&gt; 'Jay St' zone2.name =&gt; 'Fun Zone 2' zone2.seeding_unit.name =&gt; 'Seeding Unit 2' zone2.facility.name =&gt; 'Jay St'</p><p>More on Server Calls MockServer uses an internal factory and store to simulate data to return during a fetch. For GET requests, it will first try to return a defined object from the store. If that misses, it will return an object from the default factory. PATCH requests return the properties that were sent, and POST requests return a new object with the properties that were sent with a new id. Special cases such as defining specific routes (eg for external apis), delayed responses (for race conditions), and error states are described below.</p><p>Example with a component</p><p>// Component @inject('dataStore') class Button extends Component { @observable zone changeZoneName = (name) =&gt; { const { zone } = this zone.name = name zone.save() } componentDidMount() { this.loadData() }</p><p>loadData = async () { const { dataStore, zoneId } = this.props this.zone = await dataStore.fetchOne('zones', zoneId) } render () { const { name } = this.zone?.name const { changeZoneName } = this return &lt;button onClick={() =&gt; changeZoneName('Zone 2')}&gt;{name} } }</p><p>// Test describe('it changes the zone name', () =&gt; { let wrapper</p><p>beforeEach(() =&gt; { mockServer.start()</p><pre><code>wrapper = mount(
  &lt;TestContextWrapper&gt;
    &lt;Button zoneId='1' /&gt;
  &lt;/TestContextWrapper&gt;
)
setImmediate((done) =&gt; {
  wrapper.update()
  done()
})
</code></pre><p>})</p><p>it('changes zone name when clicked', () =&gt; { expect(wrapper.text()).toMatch('Zone 1') wrapper.find('button').simulate('click') expect(wrapper.text()).toMatch('Zone 2') expect(fetch.mock.calls).toHaveLength(2) const [fetchZone, patchZone] = fetch.mock.calls expect(fetchZone[0].method).toEqual('GET') expect(fetchZone[0].body).toMatch('Zone 1') expect(fetchZone[0].method).toEqual('PATCH') expect(fetchZone[0].body).toMatch('Zone 2') }) })</p><p>Example with a helper</p><p>export const fetchZone = (zoneId) { return dataStore.fetchOne('zones', zoneId) }</p><p>// Test describe('fetchZone', () =&gt; { let factoryFarm let wrapper</p><p>beforeEach(() =&gt; { const mockServer = new MockServer() mockServer.start() })</p><p>it('loads the zone', async (done) =&gt; { const zone = await fetchZone('1') expect(zone.name).toMatch('Zone 1') expect(fetch.mock.calls).toHaveLength(1) expect(fetch.mock.calls[0].method).toEqual('GET') }) })</p><p>Example - failure on specific call</p><p>// Testing a catch alerts with errors it('returns errors if saving fails', async (done) =&gt; { expect.assertions(3) // Include non 200 status in response override (default is 200) const responseOverrides = [ { path: '/new/completions', method: 'POST', status: 500, response: () =&gt; { return { errors: [{ title: 'Invalid options', detail: 'There is an error!', meta: { server: true } }], } }, }, ]</p><pre><code>// Pass in response overrides when starting the server
const mockServer = new MockServer()
mockServer.start({ responseOverrides })

window.alert = jest.fn()
expect(fetch.mock.calls).toHaveLength(1)

const submitBtn = wrapper.find('button[data-testid=&quot;manual-task-submit-button&quot;]')
await submitBtn.simulate('click')

expect(fetch.mock.calls).toHaveLength(2)
setImmediate(() =&gt; {
  expect(window.alert).toHaveBeenCalledWith('There is an error!')
  done()
})
</code></pre><p>})</p><p>Example - failure on all calls</p><p>// Testing a catch alerts with errors it('returns errors if saving fails', async (done) =&gt; { expect.assertions(2)</p><pre><code>// Pass in non-200 status when starting the server (this will fail all responses)
const mockServer = new MockServer()
mockServer.start({ status: 500 })

expect(fetch.mock.calls).toHaveLength(1)
const submitBtn = wrapper.find('button[data-testid=&quot;manual-task-submit-button&quot;]')

try {
  await submitBtn.simulate('click')
} catch (error) {
  expect(fetch.mock.calls).toHaveLength(2)
}
</code></pre><p>})</p><p>Customizing Data You can pass in a factory or store to define data that will be returned by the server, using the factoryFarm and store in the constructor options. Passing factoriesForType will allow you to use a defined factory for mocking data instead of the default factory.</p><p>// Component @inject('dataStore') class Button extends Component { @observable zone</p><p>componentDidMount() { this.loadData() }</p><p>loadData = async () { const { dataStore, zoneId } = this.props this.zone = await dataStore.fetchOne('zones', zoneId) }</p><p>render () { const { name } = this.zone?.name const { changeZoneName } = this return &lt;button onClick={() =&gt; changeZoneName('Zone 2')}&gt;{name} } }</p><p>// Test describe('it displays the zone name', () =&gt; { let factoryFarm let wrapper</p><p>beforeEach(() =&gt; { const mockServer = new MockServer() mockServer.define('funZone', { name: (index) =&gt; <code>Fun Zone ${index}</code> })</p><pre><code>mockServer.start({
  factoriesForType: { zones: 'funZone' },
})

wrapper = mount(
  &lt;TestContextWrapper&gt;
    &lt;Button zoneId='1'/&gt;
  &lt;/TestContextWrapper&gt;
)

setImmediate((done) =&gt; {
  wrapper.update()
  done()
})
</code></pre><p>})</p><p>it('displays the zone name', () =&gt; { expect(wrapper.text()).toMatch('Fun Zone 1') expect(fetch.mock.calls).toHaveLength(1) expect(fetch.mock.calls[0].method).toEqual('GET') }) })</p><p>Complex Setup responseOverrides will take a hash of responses and use those to match fetch calls, overriding the serverâ€™s calls to the store. delayedResponse, in conjunction with serverResponse, adds a timeout to the promise to simulate a delay in returning from the server.</p><h3>Errors</h3><p><code>errorMessages</code>: These are optional error messages that can be configured to provide additional details when returning errors for various requests. Each property corresponds to an HTTP status code which can be customized, and any errors returned from the server that have a <code>status</code> matching this code will have their <code>detail</code> property overriden by this value. A <code>default</code> can also be set as a fallback.</p><h3>Persisting records with <code>Model#save</code></h3><p>Records created on client side can be persisted via an AJAX request by calling the <code>save</code> method on the record.</p><pre class="prettyprint source lang-JavaScript"><code>const todo = store.add('todos', { title: 'Buy Milk', category: 'chores' })

// POST /todos
await todo.save()
</code></pre><p>If the server responds to a <code>save</code> with a status code that is not 200 or 201, then the <code>Model#errors</code> object will populated by matching <a href="https://jsonapi.org/format/#error-objects">source pointers</a> from the response to the attributes on the model.</p><h3>Handling errors</h3><p>If any fetch, save, or destroy fails, the query will return a rejected promise with an error containing any JSONAPI errors returned with the response. If no errors are present, then the response status will be converted to an error and returned with the corresponding <a href="#initializing-stores">configured error message</a>.</p><p>For example, if the server returns a 500 response with no body for a <code>fetchOne</code>, then the error returned will be</p><pre class="prettyprint source lang-JavaScript"><code>  [
    {
      detail: &quot;Something went wrong.&quot;,
      status: 500
    }
  ]
</code></pre><p>This value will always be a stringified JSON array, so you can handle errors as such:</p><pre class="prettyprint source lang-JavaScript"><code>  try {
    await store.fetchMany('todos', ids);
  } catch (error) {
    const errors = JSON.parse(error.message);
    console.log(errors[0].detail); // &quot;Something went wrong.&quot;
    console.log(errors[0].status); // 500
  }
</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="d1jZh5CKpzcf7Kh8plHnh"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="FactoryFarm.html">FactoryFarm</a></div><div class="sidebar-section-children"><a href="FactoryFarm.html">FactoryFarm</a></div><div class="sidebar-section-children"><a href="MockServer.html">MockServer</a></div><div class="sidebar-section-children"><a href="Model.html">Model</a></div><div class="sidebar-section-children"><a href="RelatedRecordsArray.html">RelatedRecordsArray</a></div><div class="sidebar-section-children"><a href="Store.html">Store</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="HwVUssk5MbL3n5oYoGdTm"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#QueryString">QueryString</a></div><div class="sidebar-section-children"><a href="global.html#addIncluded">addIncluded</a></div><div class="sidebar-section-children"><a href="global.html#addRelatedRecord">addRelatedRecord</a></div><div class="sidebar-section-children"><a href="global.html#circularFetchError">circularFetchError</a></div><div class="sidebar-section-children"><a href="global.html#circularFindError">circularFindError</a></div><div class="sidebar-section-children"><a href="global.html#coerceDataToExistingRecord">coerceDataToExistingRecord</a></div><div class="sidebar-section-children"><a href="global.html#combineRacedRequests">combineRacedRequests</a></div><div class="sidebar-section-children"><a href="global.html#defineToManyRelationships">defineToManyRelationships</a></div><div class="sidebar-section-children"><a href="global.html#defineToOneRelationships">defineToOneRelationships</a></div><div class="sidebar-section-children"><a href="global.html#definitionsByDirection">definitionsByDirection</a></div><div class="sidebar-section-children"><a href="global.html#deriveIdQueryStrings">deriveIdQueryStrings</a></div><div class="sidebar-section-children"><a href="global.html#diff">diff</a></div><div class="sidebar-section-children"><a href="global.html#disallowFetches">disallowFetches</a></div><div class="sidebar-section-children"><a href="global.html#getOneFromFactory">getOneFromFactory</a></div><div class="sidebar-section-children"><a href="global.html#makeDate">makeDate</a></div><div class="sidebar-section-children"><a href="global.html#mobxAnnotations">mobxAnnotations</a></div><div class="sidebar-section-children"><a href="global.html#mobxAnnotations">mobxAnnotations</a></div><div class="sidebar-section-children"><a href="global.html#parseErrorPointer">parseErrorPointer</a></div><div class="sidebar-section-children"><a href="global.html#parseErrors">parseErrors</a></div><div class="sidebar-section-children"><a href="global.html#removeRelatedRecord">removeRelatedRecord</a></div><div class="sidebar-section-children"><a href="global.html#requestUrl">requestUrl</a></div><div class="sidebar-section-children"><a href="global.html#serverResponse">serverResponse</a></div><div class="sidebar-section-children"><a href="global.html#setRelatedRecord">setRelatedRecord</a></div><div class="sidebar-section-children"><a href="global.html#simulatePatch">simulatePatch</a></div><div class="sidebar-section-children"><a href="global.html#simulatePost">simulatePost</a></div><div class="sidebar-section-children"><a href="global.html#singularizeType">singularizeType</a></div><div class="sidebar-section-children"><a href="global.html#stringifyIds">stringifyIds</a></div><div class="sidebar-section-children"><a href="global.html#validatePresence">validatePresence</a></div><div class="sidebar-section-children"><a href="global.html#validateProperties">validateProperties</a></div><div class="sidebar-section-children"><a href="global.html#walk">walk</a></div><div class="sidebar-section-children"><a href="global.html#wrapResponse">wrapResponse</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>