<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/FactoryFarm.js - mobx-async-store</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="mobx-async-store" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 4.3.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/FactoryFarm.html">FactoryFarm</a></li>
                                <li><a href="../classes/MockServer.html">MockServer</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/RelatedRecordsArray.html">RelatedRecordsArray</a></li>
                                <li><a href="../classes/Schema.html">Schema</a></li>
                                <li><a href="../classes/Store.html">Store</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/FactoryFarm.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Store from &#x27;./Store&#x27;
import clone from &#x27;lodash/clone&#x27;
import times from &#x27;lodash/times&#x27;

/**
 * A class to create and use factories
 * @class FactoryFarm
 */
class FactoryFarm {
  constructor (store) {
    this.store = store || new Store()
    this.store.__usedForFactoryFarm__ = true
  }

  /**
   * A hash of available factories. A factory is an object with a structure like:
   * { name, type, attributes, relationships }.
   * @property factories
   * @type {Object}
   */
  factories = {}

  /**
   * A hash of singleton objects.
   * @property factories
   * @type {Object}
   */
  singletons = {}

  /**
   * Allows easy building of ArtemisStore objects, including relationships.
   * Takes parameters &#x60;attributes&#x60; and &#x60;relationships&#x60; to use for building.
   *
   *   const batchAction = store.build(&#x27;cropBatchAction&#x27;)
   *   store.build(&#x27;basilBatch&#x27;, {
   *     arbitrary_id: &#x27;new_id&#x27;
   *     zone: &#x27;bay1&#x27;,
   *     crop_batch_actions: [
   *       batchAction,
   *       store.build(&#x27;batchAction&#x27;)
   *     ]
   *   })
   *
   * @method build
   * @param {String} factoryName the name of the factory to use
   * @param {Object} overrideOptions overrides for the factory
   * @param {Number} numberOfRecords optional number of models to build
   * @return {Object} instance of an ArtemisStore model
   */
  build (factoryName, overrideOptions = {}, numberOfRecords = 1) {
    const { store, factories, singletons, _verifyFactory, _buildModel } = this
    _verifyFactory(factoryName)
    const { type, ...properties } = factories[factoryName]

    const newModelProperties = {
      id: (i) =&gt; String(store.getAll(type).length + i + 1),
      ...properties,
      ...overrideOptions
    }

    let identity = false
    if (newModelProperties.identity) {
      if (typeof newModelProperties.identity === &#x27;string&#x27;) {
        identity = newModelProperties.identity
      } else {
        identity = factoryName
      }
      delete newModelProperties.identity
      if (numberOfRecords === 1) {
        if (singletons[identity]) return singletons[identity]
      }
    }

    let addProperties

    if (numberOfRecords &gt; 1) {
      addProperties = times(numberOfRecords, (i) =&gt; _buildModel(factoryName, newModelProperties, i))
    } else {
      addProperties = _buildModel(factoryName, newModelProperties)
    }

    const results = store.add(type, addProperties)

    if (identity) {
      singletons[identity] = results
    }

    return results
  }

  /**
   * Creates a factory with { name, type, parent, ...attributesAndRelationships }, which can be used for
   * building test data.
   * The factory is named, with a set of options to use to configure it.
   *   * parent - use another factory as a basis for this one
   *   * type - the type of model to use (for use if no parent)
   *   * identity - whether this factory should be a singleton
   * attributesAndRelationships - attributes and relationships. If properties are a function or an array of functions, they
   *   will be executed at runtime.
   *
   * @method define
   * @param {String} name the name to use for the factory
   * @param {Object} options
   */
  define (name, options = {}) {
    const { type, parent, ...properties } = options

    let factory

    if (parent) {
      const fromFactory = this.factories[parent]

      if (!fromFactory) {
        throw new Error(&#x60;Factory ${parent} does not exist&#x60;)
      }

      factory = {
        ...fromFactory,
        ...properties
      }
    } else {
      factory = {
        type,
        ...properties
      }
    }

    this.factories[name] = factory
  }

  /**
   * Alias for &#x60;this.store.add&#x60;
   * @method add
   * @param  {...any} params
   * @return {*} object or array
   */
  add = (...params) =&gt; this.store.add(...params)

  /**
   * Verifies that the requested factory exists
   * @method _verifyFactory
   * @param {String} factoryName
   * @private
   */
  _verifyFactory = (factoryName) =&gt; {
    const factory = this.factories[factoryName]

    if (!factory) {
      throw new Error(&#x60;Factory ${factoryName} does not exist&#x60;)
    }
  }

  /**
   * Builds model properties that will be used for creating models. Since factories can use
   * functions to define relationships, it loops through properties and attempts to execute any functions.
   *
   * @method _buildModel
   * @param {String} factoryName
   * @param {Object} properties
   * @param {Number} index
   * @return {Object} an object of properties to be used.
   * @private
   */
  _buildModel = (factoryName, properties, index = 0) =&gt; {
    properties = clone(properties)
    Object.keys(properties).forEach((key) =&gt; {
      if (Array.isArray(properties[key])) {
        properties[key] = properties[key].map((propDefinition) =&gt; {
          return this._callPropertyDefinition(propDefinition, index, factoryName, properties)
        })
      } else {
        properties[key] = this._callPropertyDefinition(properties[key], index, factoryName, properties)
      }
    })
    return properties
  }

  /**
   * If &#x60;definition&#x60; is a function, calls the function. Otherwise, returns the definition.
   * @method _callPropertyDefinition
   * @param {*} definition
   * @param {Number} index
   * @param {String} factoryName
   * @param {Object} properties
   * @return {*}
   */
  _callPropertyDefinition = (definition, index, factoryName, properties) =&gt; {
    return typeof definition === &#x27;function&#x27; ? definition.call(this, index, factoryName, properties) : definition
  }
}

export default FactoryFarm

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
